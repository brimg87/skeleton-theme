<section class="section-collection-showcase section-padding">
  <div class="container">
    {% if section.settings.title != blank %}
      <h2 class="section-title" data-text="{{ section.settings.title | escape }}">{{ section.settings.title | escape }}</h2>
    {% endif %}
    
    {% if section.settings.description != blank %}
      <div class="section-description data-box">
        <div class="data-box-header">[SYSTEM_BRIEFING]</div>
        <div class="data-box-content">
          <p>{{ section.settings.description }}</p>
        </div>
      </div>
    {% endif %}

    <div class="collection-grid">
      {% if section.blocks.size > 0 %}
        {% for block in section.blocks %}
          {% assign collection = collections[block.settings.collection] %}
          {% if collection != blank %}
            <a href="{{ collection.url }}" class="collection-card" {{ block.shopify_attributes }}>
              <div class="collection-image-container">
                {% if collection.featured_image != blank %}
                  <img src="{{ collection.featured_image | image_url: width: 400, height: 300 }}" 
                       alt="{{ collection.featured_image.alt | default: collection.title }}" 
                       loading="lazy" 
                       class="collection-image">
                {% elsif block.settings.fallback_image != blank %}
                  <img src="{{ block.settings.fallback_image | image_url: width: 400, height: 300 }}" 
                       alt="{{ block.settings.fallback_image.alt | default: collection.title }}" 
                       loading="lazy" 
                       class="collection-image">
                {% else %}
                  <div class="collection-image-placeholder">
                    {% if block.settings.icon_html != blank %}
                      <span class="collection-icon">{{ block.settings.icon_html }}</span>
                    {% else %}
                      <span class="collection-icon"><i class="fas fa-cube"></i></span>
                    {% endif %}
                  </div>
                {% endif %}
                
                <div class="collection-overlay">
                  <div class="collection-stats">
                    <span class="product-count">[{{ collection.products_count }}_ITEMS_AVAILABLE]</span>
                    {% if collection.products_count > 0 %}
                      <span class="status-indicator">[OPERATIONAL]</span>
                    {% else %}
                      <span class="status-indicator status-empty">[RESTOCKING]</span>
                    {% endif %}
                  </div>
                </div>
              </div>
              
              <div class="collection-info">
                <h3 class="collection-title">
                  {% if block.settings.custom_title != blank %}
                    {{ block.settings.custom_title }}
                  {% else %}
                    {{ collection.title | upcase }}
                  {% endif %}
                </h3>
                
                {% if collection.description != blank %}
                  <p class="collection-description">{{ collection.description | truncate: 120 }}</p>
                {% elsif block.settings.custom_description != blank %}
                  <p class="collection-description">{{ block.settings.custom_description | truncate: 120 }}</p>
                {% endif %}
                
                <div class="collection-cta">
                  <span class="cta-text">[ACCESS_INVENTORY]</span>
                  <i class="fas fa-arrow-right cta-arrow"></i>
                </div>
              </div>
            </a>
          {% else %}
            {% comment %} Fallback for invalid collection {% endcomment %}
            <div class="collection-card collection-card-placeholder" {{ block.shopify_attributes }}>
              <div class="collection-image-container">
                <div class="collection-image-placeholder">
                  <span class="collection-icon"><i class="fas fa-exclamation-triangle"></i></span>
                </div>
              </div>
              <div class="collection-info">
                <h3 class="collection-title">[COLLECTION_NOT_FOUND]</h3>
                <p class="collection-description">Please select a valid collection in the theme editor.</p>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      {% else %}
        {% comment %} Show placeholder cards if no blocks are added {% endcomment %}
        {% for i in (1..3) %}
          <div class="collection-card collection-card-placeholder">
            <div class="collection-image-container">
              <div class="collection-image-placeholder">
                <span class="collection-icon"><i class="fas fa-cube"></i></span>
              </div>
            </div>
            <div class="collection-info">
              <h3 class="collection-title">[COLLECTION_{{ i }}]</h3>
              <p class="collection-description">Add collection blocks in the theme editor to showcase your product categories.</p>
              <div class="collection-cta">
                <span class="cta-text">[CONFIGURE_SECTION]</span>
              </div>
            </div>
          </div>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Collection Showcase",
  "tag": "section",
  "class": "section-collection-showcase",
  "max_blocks": 8,
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "// INVENTORY_CATEGORIES //"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Access specialized equipment categories from our secure inventory systems."
    }
  ],
  "blocks": [
    {
      "type": "collection_card",
      "name": "Collection Card",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection",
          "info": "Select the collection to showcase"
        },
        {
          "type": "text",
          "id": "custom_title",
          "label": "Custom Title (optional)",
          "info": "Override the collection title with custom text"
        },
        {
          "type": "textarea",
          "id": "custom_description",
          "label": "Custom Description (optional)",
          "info": "Override the collection description with custom text"
        },
        {
          "type": "image_picker",
          "id": "fallback_image",
          "label": "Fallback Image",
          "info": "Used if the collection doesn't have a featured image"
        },
        {
          "type": "html",
          "id": "icon_html",
          "label": "Icon HTML (for placeholder)",
          "default": "<i class='fas fa-cube'></i>",
          "info": "FontAwesome icon shown when no image is available. Example: <i class='fas fa-shield-alt'></i>"
        }
      ]
    }
  ],
  "presets": [{
    "name": "Collection Showcase",
    "blocks": [
      { 
        "type": "collection_card",
        "settings": {
          "icon_html": "<i class='fas fa-shield-alt'></i>"
        }
      },
      { 
        "type": "collection_card",
        "settings": {
          "icon_html": "<i class='fas fa-crosshairs'></i>"
        }
      },
      { 
        "type": "collection_card",
        "settings": {
          "icon_html": "<i class='fas fa-cog'></i>"
        }
      }
    ]
  }]
}
{% endschema %}