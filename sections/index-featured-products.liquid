{% comment %}
  Refactored Featured Products Section
  - Removes external CSS dependency.
  - Uses standardized .section-wrapper and .container classes.
  - Relies on global .product-grid CSS for layout.
  - Simplifies product card HTML to match our .product-card component.
  - Removes redundant schema settings for layout and padding.
{% endcomment %}

<section class="section-wrapper section-standard">
  <div class="container">
    {%- if section.settings.title != blank -%}
      <div class="section-header text-{{ section.settings.header_alignment }}">
        <h2 class="section-title" data-text="{{ section.settings.title | escape }}">{{ section.settings.title | escape }}</h2>
        {%- if section.settings.description != blank -%}
          <div class="section-description rte">{{ section.settings.description }}</div>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="product-grid">
      {%- assign collection = section.settings.collection -%}
      {%- assign products_to_show = section.settings.products_to_show -%}

      {%- if collection.products_count > 0 -%}
        {%- for product in collection.products limit: products_to_show -%}
          <div class="product-card shape-card">
            <div class="product-image">
              <a href="{{ product.url | within: collection }}">
                {%- if product.featured_image -%}
                  <img
                    src="{{ product.featured_image | image_url: width: 600 }}"
                    alt="{{ product.featured_image.alt | escape }}"
                    loading="lazy"
                    width="600"
                    height="{{ 600 | divided_by: product.featured_image.aspect_ratio | round }}">
                {%- else -%}
                    {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                {%- endif -%}
              </a>
            </div>
            <div class="product-info">
              <h3 class="product-name">
                <a href="{{ product.url | within: collection }}">{{ product.title }}</a>
              </h3>
              <p class="product-price">{{ product.price | money }}</p>
              <a href="{{ product.url | within: collection }}" class="btn btn-secondary btn-sm shape-button">
                {{ section.settings.button_label | default: '[ANALYZE_ITEM]' }}
              </a>
            </div>
          </div>
        {%- endfor -%}
      {%- else -%}
        {%- comment -%} Onboarding placeholders for the Theme Editor {%- endcomment -%}
        {%- for i in (1..section.settings.products_to_show) -%}
          <div class="product-card shape-card">
            <div class="product-image">
              {{ 'product-' | append: i | placeholder_svg_tag: 'placeholder-svg' }}
            </div>
            <div class="product-info">
              <h3 class="product-name">EQUIPMENT_SLOT_{{ forloop.index }}</h3>
              <p class="product-price">â‚¬$ ---</p>
              <button class="btn btn-secondary btn-sm shape-button disabled" disabled>[AWAITING_INVENTORY]</button>
            </div>
          </div>
        {%- endfor -%}
      {%- endif -%}
    </div>

    {%- if section.settings.show_view_all and collection.products_count > section.settings.products_to_show -%}
      <div class="section-footer text-center mt-xl">
        <a href="{{ collection.url }}" class="btn btn-secondary shape-button">
          {{ 'sections.featured_collection.view_all' | t }}
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Featured Products",
  "tag": "section",
  "class": "section-featured-products",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "// FEATURED_ITEMS //"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "select",
      "id": "header_alignment",
      "label": "Header alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ],
      "default": "center"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 8,
      "step": 1,
      "label": "Products to show",
      "default": 4
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View all' button if collection has more products",
      "default": true
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Product card button label",
      "default": "[ANALYZE_ITEM]"
    }
  ],
  "presets": [
    {
      "name": "Featured Products"
    }
  ]
}
{% endschema %}